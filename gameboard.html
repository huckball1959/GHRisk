<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Risk Dice Simulation</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      height: 100vh;
      font-family: Arial, sans-serif;
    }
    /* Main container splits the page into a map area and a panel area */
    #container {
      display: flex;
      width: 100%;
      height: 100%;
    }
    /* Map container takes 70% of the page width */
    #mapContainer {
      flex: 7;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #eaeaea;
    }
    #svgContainer {
      width: 100%;
      height: 100%;
      display: flex;
    }
    svg {
      width: 100%;
      height: 100%;
      object-fit: fill;
    }
    /* Right panel container for dice roller */
    #panel {
      flex: 3;
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      background-color: #f0f0f0;
      padding: 20px;
      box-shadow: -2px 0px 5px rgba(0, 0, 0, 0.1);
    }
    /* Dice roller styling */
    .dice {
      display: flex;
      justify-content: space-around;
      align-items: center;
      margin: 10px 0;
    }
    .dice div {
      width: 60px;
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      font-weight: bold;
      border-radius: 8px;
      text-align: center;
    }
    .red-dice {
      background-color: red;
      color: white;
    }
    .white-dice {
      background-color: white;
      color: black;
      border: 1px solid black;
    }
    #rollButton {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      font-weight: bold;
      color: white;
      background-color: #007bff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #rollButton:hover {
      background-color: #0056b3;
    }
    #results {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
      text-align: center;
    }
  </style>
</head>
<body>
  <div id="container">
    <!-- Left container for the map -->
    <div id="mapContainer">
      <div id="svgContainer"></div>
    </div>

    <!-- Right container for the dice roller -->
    <div id="panel">
      <div class="dice" id="redDice">
        <div class="red-dice">1</div>
        <div class="red-dice">1</div>
        <div class="red-dice">1</div>
      </div>
      <div class="dice" id="whiteDice">
        <div class="white-dice">1</div>
        <div class="white-dice">1</div>
      </div>
      <button id="rollButton">Roll</button>
      <div id="results"></div>
    </div>
  </div>

  <script>
    // Initial army counts
    let brazilArmies = 50; // Attacker
    let peruArmies = 50; // Defender

    // Function to roll a single die
    const rollDie = () => Math.floor(Math.random() * 6) + 1;

    // Function to update dice display
    const updateDiceDisplay = (dice, values) => {
      const diceElements = dice.children;
      for (let i = 0; i < values.length; i++) {
        diceElements[i].textContent = values[i];
      }
    };

    // Function to handle dice rolling and battle logic
    const handleRoll = () => {
      if (brazilArmies < 2 || peruArmies < 1) {
        document.getElementById('results').textContent = 'Battle Over! Reset to play again.';
        return;
      }

      // Roll dice
      const redDiceValues = [rollDie(), rollDie(), rollDie()].sort((a, b) => b - a);
      const whiteDiceValues = [rollDie(), rollDie()].sort((a, b) => b - a);

      // Update dice displays
      updateDiceDisplay(document.getElementById('redDice'), redDiceValues);
      updateDiceDisplay(document.getElementById('whiteDice'), whiteDiceValues);

      // Compare dice results
      let attackerLosses = 0;
      let defenderLosses = 0;
      for (let i = 0; i < Math.min(redDiceValues.length, whiteDiceValues.length); i++) {
        if (redDiceValues[i] > whiteDiceValues[i]) {
          defenderLosses++;
        } else {
          attackerLosses++;
        }
      }

      // Update armies
      brazilArmies -= attackerLosses;
      peruArmies -= defenderLosses;

      // Display results
      document.getElementById('results').textContent = `
        Brazil lost ${attackerLosses} armies. Remaining: ${brazilArmies}
        Peru lost ${defenderLosses} armies. Remaining: ${peruArmies}
      `;

      // Update map text (if applicable)
      const brazilText = document.querySelector('#brazil-text');
      const peruText = document.querySelector('#peru-text');
      if (brazilText) brazilText.textContent = brazilArmies;
      if (peruText) peruText.textContent = peruArmies;
    };

    // Add event listener to roll button
    document.getElementById('rollButton').addEventListener('click', handleRoll);

    // Load the SVG map and dynamically adjust scaling
    fetch('map.svg')
      .then(response => response.text())
      .then(svgContent => {
        // Insert the SVG content into the container
        const container = document.getElementById('svgContainer');
        container.innerHTML = svgContent;

        // Ensure the SVG stretches to fill the container
        const svgElement = container.querySelector('svg');
        if (svgElement) {
          svgElement.setAttribute('preserveAspectRatio', 'none'); // Ensures the map stretches
        }

        // Function to style a circle and add text
        const styleCircle = (id, fillColor, textColor, textContent) => {
          const circle = container.querySelector(`#${id}`);
          if (circle) {
            circle.setAttribute('style', `fill:${fillColor};stroke-width:0.75`);
            const existingText = container.querySelector(`#${id}-text`);
            if (existingText) {
              existingText.textContent = textContent;
              existingText.setAttribute('fill', textColor);
            } else {
              const textElement = document.createElementNS('http://www.w3.org/2000/svg', 'text');
              textElement.setAttribute('id', `${id}-text`);
              textElement.setAttribute('x', circle.getAttribute('cx'));
              textElement.setAttribute('y', circle.getAttribute('cy'));
              textElement.setAttribute('text-anchor', 'middle');
              textElement.setAttribute('dominant-baseline', 'middle');
              textElement.setAttribute('fill', textColor);
              textElement.setAttribute('font-size', '36');
              textElement.setAttribute('font-family', 'Arial');
              textElement.setAttribute('font-weight', 'bolder');
              textElement.textContent = textContent;
              circle.parentNode.appendChild(textElement);
            }
          }
        };

        // Style Brazil and Peru
        styleCircle('brazil', 'red', 'black', brazilArmies);
        styleCircle('peru', 'blue', 'white', peruArmies);
      })
      .catch(error => console.error('Error loading the SVG file:', error));
  </script>
</body>
</html>